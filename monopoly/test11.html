<!DOCTYPE html>
<html>
	<head>
		<title>monoPoly Scene</title>
			<!-- aframe-master.js 와 ar 관련 js 다른 경로에 두어야 한다. -->
			<script src="dist/aframe-master.js"></script>
			<script src="js/three.ar.js"></script>
	    	<script src="js/aframe-ar.js"></script>
			<script src="js/aframe-extras.js"></script>
			<script src="js/aframe-gui.js"></script>
			<script src="js/utils4.js"></script>
			<script src="js/text-geometry/build.js"></script>
		<script>

			var moveNo = 0;
			AFRAME.registerComponent("user1-object", {
				schema: {
					// moveX: {type: "number", default: 0},
					// moveY: {type: "number", default: 0},
					// moveZ: {type: "number", default: 0}
				},
				init: function () {
					this.id = this.el.getAttribute("id");
					this.positionIndex = 0;
					gameStatus = "00";
					gameInfo.gameUser[0]._this = this;
					utils.obj("#" + this.id).setAttribute("rotation", {x:-180, y:360, z:-180});

				},
				tick: function (time, timeDelta) {
					// 사용자의 순서일경우
					if(this.id == gameInfo.gameUser[nowGameUserIndex].id){
						console.log("tick");
					}
				},
				tock: function(time, timeDelta){
					if(this.id == gameInfo.gameUser[nowGameUserIndex].id){
						console.log("tock");
						switch (gameStatus) {
							// 게임준비일경우
							case "00" :

								utils.objView("startConfirm", true); // 시작버튼 confilm 띄우기
								gameStatus = "01";
								console.log(utils.getGameStatus(gameStatus).name);
								break;
							// 시작버튼을 활성화 되어있을 경우
							case "01" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 게임준비 창이 비활성화 일경우 상태값 변경
								if(utils.obj("#startConfirm").getAttribute("visible") == false){
									gameStatus = "02";
								}
								break;
							// 주사위 굴리기
							case "02" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 룰렛 판이 비활성화 일경우 상태값 변경
								if(utils.obj("#rouletteBoard").getAttribute("visible") == false){
									gameStatus = "03";
								}
								break;
							// 이동
							case "03" :
								console.log(utils.getGameStatus(gameStatus).name);
								var runType = utils.obj("#" + this.id).getAttribute("animation-mixer").clip;
								if(runType == "idle"){

									utils.obj("#" + this.id).setAttribute("animation-mixer", "clip", "run");
									console.log('positionINdex : ' + this.positionIndex);
									utils.move(this.id, this.positionIndex);

								}else if(runType == "run_stop"){

									utils.obj("#" + this.id).setAttribute("animation-mixer", "clip", "idle");
									// 움직인 만큼 포지션 추가
									this.positionIndex += moveCount;

									if(this.positionIndex >= positionArr.length){
										this.positionIndex -= positionArr.length;
									}
									// 움직인 카운트 초기화
									moveCount = 0;
									// utils.objView("text", false);
									gameStatus = "04";

								}

								break;
							// 정지
							case "04" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 소유권확인
								utils.ownerCheck(this.id);
								break;
							// 말판구입
							case "05" :
								console.log(utils.getGameStatus(gameStatus).name);
								if(utils.obj("#ownerDialog").getAttribute("visible") == false){
									// 소유권확인
									utils.confirm("ownerDialog", true);
								}
								break;
							// 건물건설
							case "06" :
								console.log(utils.getGameStatus(gameStatus).name);
								if(utils.obj("#buildDialog1").getAttribute("visible") == false &&
								   utils.obj("#buildDialog2").getAttribute("visible") == false &&
								   utils.obj("#buildDialog3").getAttribute("visible") == false &&
								   utils.obj("#buildDialog4").getAttribute("visible") == false){
									// 건물 체크
									utils.buildCheck();
								}
								break;
							// 전체View
							case "07" :
								console.log(utils.getGameStatus(gameStatus).name);
								break;
							// 대기
							case "08" :
								console.log(utils.getGameStatus(gameStatus).name);
								nowGameUserIndex += 1;

								if(nowGameUserIndex + 1 > totalUser){
									nowGameUserIndex = 0;
								}
								utils.objView("rouletteBoard", true);
								gameStatus = "02";
								break;
						}
					}
				},
				update: function(){
					console.log("update");
				},
				remove: function(){
					console.log("remove");
				}
			});

			AFRAME.registerComponent("user2-object", {
				schema: {
					// moveX: {type: "number", default: 0},
					// moveY: {type: "number", default: 0},
					// moveZ: {type: "number", default: 0}
				},
				init: function () {

					this.id = this.el.getAttribute("id");
					this.positionIndex = 0;
					gameStatus = "00";
					gameInfo.gameUser[1]._this = this;
					console.log("[" + this.id + "]init");
					utils.obj("#" + this.id).setAttribute("rotation", {x:-180, y:360, z:-180});

				},
				tick: function (time, timeDelta) {
					// 사용자의 순서일경우
					if(this.id == gameInfo.gameUser[nowGameUserIndex].id){
						console.log(this);
						console.log("tick");
					}
				},
				tock: function(time, timeDelta){
					if(this.id == gameInfo.gameUser[nowGameUserIndex].id){
						console.log("tock");
						switch (gameStatus) {
							// 게임준비일경우
							case "00" :
								utils.objView("startConfirm", true); // 시작버튼 confilm 띄우기
								gameStatus = "01";
								console.log(utils.getGameStatus(gameStatus).name);
								break;
							// 시작버튼을 활성화 되어있을 경우
							case "01" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 게임준비 창이 비활성화 일경우 상태값 변경
								if(utils.obj("#startConfirm").getAttribute("visible") == false){
									gameStatus = "02";
								}
								break;
							// 주사위 굴리기
							case "02" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 룰렛 판이 비활성화 일경우 상태값 변경
								if(utils.obj("#rouletteBoard").getAttribute("visible") == false){
									gameStatus = "03";
								}
								break;
							// 이동
							case "03" :
								console.log(utils.getGameStatus(gameStatus).name);
								var runType = utils.obj("#" + this.id).getAttribute("animation-mixer").clip;
								if(runType == "idle"){

									utils.obj("#" + this.id).setAttribute("animation-mixer", "clip", "run");
									utils.move(this.id, this.positionIndex);
								}else if(runType == "run_stop"){

									utils.obj("#" + this.id).setAttribute("animation-mixer", "clip", "idle");
									// 움직인 만큼 포지션 추가
									this.positionIndex += moveCount;

									if(this.positionIndex >= positionArr.length){
										this.positionIndex -= positionArr.length;
									}
									// 움직인 카운트 초기화
									moveCount = 0;
									// utils.objView("text", false);
									gameStatus = "04";

								}

								break;
							// 정지
							case "04" :
								console.log(utils.getGameStatus(gameStatus).name);
								// 소유권확인
								utils.ownerCheck(this.id);
								break;
							// 말판구입
							case "05" :
								console.log(utils.getGameStatus(gameStatus).name);
								if(utils.obj("#ownerDialog").getAttribute("visible") == false){
									// 소유권확인
									utils.confirm("ownerDialog", true);
								}
								break;
							// 건물건설
							case "06" :
								console.log(utils.getGameStatus(gameStatus).name);
								if(utils.obj("#buildDialog1").getAttribute("visible") == false &&
								   utils.obj("#buildDialog2").getAttribute("visible") == false &&
								   utils.obj("#buildDialog3").getAttribute("visible") == false &&
								   utils.obj("#buildDialog4").getAttribute("visible") == false){
									// 건물 체크
									utils.buildCheck();
								}
								break;
							// 전체View
							case "07" :
								console.log(utils.getGameStatus(gameStatus).name);
								break;
							// 대기
							case "08" :
								console.log(utils.getGameStatus(gameStatus).name);
								nowGameUserIndex += 1;

								if(nowGameUserIndex + 1 > totalUser){
									nowGameUserIndex = 0;
								}
								utils.objView("rouletteBoard", true);
								gameStatus = "02";
								break;
						}
					}
				},
				update: function(){
					console.log("update");
				},
				remove: function(){
					console.log("remove");
				}
			});
		</script>
	</head>
	<body>
	<a-scene ar>
		<a-assets>
			<a-asset-item id="building_obj" src="models/Building.obj"></a-asset-item>
			<a-asset-item id="building_mtl" src="models/Building.mtl"></a-asset-item>
			<a-asset-item id="house_obj" src="models/HousF/HousF/houseF.obj"></a-asset-item>
			<a-asset-item id="house_mtl" src="models/HousF/HousF/houseF.mtl"></a-asset-item>
			<a-asset-item id="trump_json" src="models/trump/bot4.json"></a-asset-item>
			
			<a-asset-item id="Texture1" src="models/MaxVR/Texture1.png"></a-asset-item>
			<a-asset-item id="MaxVR_All" src="models/MaxVR/MaxVR_All.obj"></a-asset-item>
			<a-asset-item id="Test_map" src="models/MaxVR/Test_Map_01.png"></a-asset-item>
			<a-asset-item id="Test_obj" src="models/MaxVR/Test_Box.obj"></a-asset-item>
			<!-- 2 -->

			<a-asset-item id="SM_Env_Cliff" src="models/MaxVR/SM_Env_Cliff.obj"></a-asset-item>
			<a-asset-item id="SM_Env_GroundMound" src="models/MaxVR/SM_Env_GroundMound.obj"></a-asset-item>
			<a-asset-item id="SM_Env_MountainGrass" src="models/MaxVR/SM_Env_MountainGrass.obj"></a-asset-item>
			<a-asset-item id="SM_Env_MountainSnow" src="models/MaxVR/SM_Env_MountainSnow.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Tree" src="models/MaxVR/SM_Env_Tree.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Tree_Twisted" src="models/MaxVR/SM_Env_Tree_Twisted.obj"></a-asset-item>			
												
			<!-- 1 -->
			
			<a-asset-item id="SM_Env_Rune_Pillar_01" src="models/MaxVR/SM_Env_Rune_Pillar_01.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Pillar_02" src="models/MaxVR/SM_Env_Rune_Pillar_02.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Pillar_03" src="models/MaxVR/SM_Env_Rune_Pillar_03.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Pillar_04" src="models/MaxVR/SM_Env_Rune_Pillar_04.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Pillar_05" src="models/MaxVR/SM_Env_Rune_Pillar_05.obj"></a-asset-item>
			
			<a-asset-item id="SM_Env_Rune_Rounded_01" src="models/MaxVR/SM_Env_Rune_Rounded_01.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Rounded_02" src="models/MaxVR/SM_Env_Rune_Rounded_02.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Rounded_03" src="models/MaxVR/SM_Env_Rune_Rounded_03.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Rounded_04" src="models/MaxVR/SM_Env_Rune_Rounded_04.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Rounded_05" src="models/MaxVR/SM_Env_Rune_Rounded_05.obj"></a-asset-item>
			
			<a-asset-item id="SM_Env_Rune_Square_01" src="models/MaxVR/SM_Env_Rune_Square_01.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Square_02" src="models/MaxVR/SM_Env_Rune_Square_02.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Square_03" src="models/MaxVR/SM_Env_Rune_Square_03.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Square_04" src="models/MaxVR/SM_Env_Rune_Square_04.obj"></a-asset-item>
			<a-asset-item id="SM_Env_Rune_Square_05" src="models/MaxVR/SM_Env_Rune_Square_05.obj"></a-asset-item>
			
			<a-asset-item id="SM_Env_Tiles_Rune" src="models/MaxVR/SM_Env_Tiles_Rune.obj"></a-asset-item>
			
			
			
		</a-assets>
		
		<a-entity light="type: ambient; color: #BBB" id="ambientLight"></a-entity>
		<a-entity light="type: directional; color: #FFF; intensity: 0.6" position="-0.5 1 1" id="directionalLight"></a-entity>		
		
		
		<a-entity id="Cliff" obj-model="obj: #SM_Env_Cliff;" material="src: #Texture1"></a-entity>
		
		<a-entity id="Boxs" obj-model="obj: #Test_obj;" material="src: #Test_map" postion="0 10 0"></a-entity>
		
		<a-entity id="GroundMound" obj-model="obj: #SM_Env_GroundMound;" material="src: #Texture1"></a-entity>
		<a-entity id="MountainGrass" obj-model="obj: #SM_Env_MountainGrass;" material="src: #Texture1"></a-entity>
		<a-entity id="MountainSnow" obj-model="obj: #SM_Env_MountainSnow;" material="src: #Texture1"></a-entity>
		
		<!-- 1 -->
		<a-entity id="Rune_Pillar_01" obj-model="obj: #SM_Env_Rune_Pillar_01;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Pillar_02" obj-model="obj: #SM_Env_Rune_Pillar_02;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Pillar_03" obj-model="obj: #SM_Env_Rune_Pillar_03;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Pillar_04" obj-model="obj: #SM_Env_Rune_Pillar_04;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Pillar_05" obj-model="obj: #SM_Env_Rune_Pillar_05;" material="src: #Texture1"></a-entity>
		
		<a-entity id="Rune_Rounded_01" obj-model="obj: #SM_Env_Rune_Rounded_01;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Rounded_02" obj-model="obj: #SM_Env_Rune_Rounded_02;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Rounded_03" obj-model="obj: #SM_Env_Rune_Rounded_03;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Rounded_04" obj-model="obj: #SM_Env_Rune_Rounded_04;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Rounded_05" obj-model="obj: #SM_Env_Rune_Rounded_05;" material="src: #Texture1"></a-entity>
		
		<a-entity id="Rune_Square_01" obj-model="obj: #SM_Env_Rune_Square_01;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Square_02" obj-model="obj: #SM_Env_Rune_Square_02;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Square_03" obj-model="obj: #SM_Env_Rune_Square_03;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Square_04" obj-model="obj: #SM_Env_Rune_Square_04;" material="src: #Texture1"></a-entity>
		<a-entity id="Rune_Square_05" obj-model="obj: #SM_Env_Rune_Square_05;" material="src: #Texture1"></a-entity>
		
		<a-entity id="Tiles_Rune" obj-model="obj: #SM_Env_Tiles_Rune;" material="src: #Texture1"></a-entity>
		<!-- 1 -->
		
		<a-entity id="Tree" obj-model="obj: #SM_Env_Tree;" material="src: #Texture1"></a-entity>
		<a-entity id="Tree_Twisted" obj-model="obj: #SM_Env_Tree_Twisted;" material="src: #Texture1"></a-entity>
		

		<a-camera id="gameViewCamera">
			<a-entity id="ray" cursor="" geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.016" material="color: #EEE" position="0 0 -1"></a-entity>
		</a-camera>

    </a-scene>
    <script src="dist/aframe-inspector.js"></script>
  </body>
</html>
