<!DOCTYPE html>
<html>
<head>
    <title>K-Frame</title>
    <meta name="description" content="K-Frame">
    <script src="resources/js/jquery.3.2.1.min.js"></script>
    <script src="resources/js/go.js"></script>
    <script src="resources/js/go_extention_TextEditorSelectBox.js"></script>
    <script src="resources/js/go_extention_TextEditorRadioButtons.js"></script>
    <script src="resources/js/highlight.js"></script>
    <script src="resources/js/aframe-master.js"></script>
    <script src="resources/js/aframe-physics-system.js"></script>
    <script src="resources/js/aframe-physics-extras.js"></script>
    <script src="resources/js/aframe-animation-component.js"></script>
    <script src="resources/js/kframe.js"></script>
    <script src="resources/js/aframe-extras.js"></script>
    <script src="https://cdn.rawgit.com/feiss/aframe-environment-component/76b2bbf3/aframe-environment-component.min.js"></script>
    <script src="resources/js/aframe-text-geometry-component.js"></script>
    <script src="resources/js/maxUtils.js"></script>
    <script src="resources/js/components.js"></script>
    <link rel="stylesheet" href="resources/css/style.css">
    <script type="text/javascript">
        window.projectCode = "PROJ20181203134234782";
        window.sceneCode = "SCEN20181203134235048";

        //2018-11-23 임시 keydown 이벤트 추가
        window.addEventListener('keydown', function(e){
            console.log("키다운 이벤트 호출 : " + e.keyCode);
            if(e.keyCode === 89){//keydownEvent y
                KEvent.broadcast('e_yes');
            } else if(e.keyCode === 78){//keydownEvent n
                KEvent.broadcast('e_no');
            }
        });
        /**** /서버에서 자동으로 만들어지는 스크립트/ ****/

        var _AssetObject_;
        function setAssetObject(value) {
            _AssetObject_ = value;
        }

        function showAlert() {
            alert(_AssetObject_);
            _AssetObject_.showAlert();
        }

        var _ComponentObject_;
        function setComponentObject(obj) {
            _ComponentObject_ = obj;
        }

        function reloadAsset() {
            _AssetObject_.load();
        }
        function getSceneData() {
            return maxUtils.getCurrentSceneData();
        }

        function getProjectCode() {
            return window.projectCode;
        }

        var isOpenInspector = true;
        function Inspector() {
            if(isOpenInspector) {
                AFRAME.INSPECTOR.close();
                isOpenInspector = false;
            } else {n
                AFRAME.INSPECTOR.open();
                isOpenInspector = true;
            }
        }

        var CustomComponentList = new Array();

        var __component;
        try {
            __component = new Object();
            __component.componentCode = "COMP20181203134235438";
            __component.componentName = "clicktest";
            __component.dataJson = maxUtils.replaceAll('{"id":"COMP20181203134235438","name":"clicktest","desc":"","variables":[],"events":[{"id":5,"name":"시작시","data":{"linkFromPortIdProperty":"fromPinUid","linkToPortIdProperty":"toPinUid","linkFromKeyProperty":"fromNodeKey","linkToKeyProperty":"toNodeKey","nodeCategoryProperty":"kind","linkCategoryProperty":"clazz","nodeKeyProperty":"key","nodeDataArray":[{"key":1,"id":"CODE20180404201644461","kind":"event","text":"시작시","inputs":[],"outputs":[{"uid":"1","id":"out0","clazz":"Flow","text":"","__gohashid":1960}],"loc":"0 0","__gohashid":1930}],"linkDataArray":[]}},{"id":3,"name":"클릭시","data":{"linkFromPortIdProperty":"fromPinUid","linkToPortIdProperty":"toPinUid","linkFromKeyProperty":"fromNodeKey","linkToKeyProperty":"toNodeKey","nodeCategoryProperty":"kind","linkCategoryProperty":"clazz","nodeKeyProperty":"key","nodeDataArray":[{"key":1,"id":"CODE20180404204924566","kind":"event","text":"클릭시","inputs":[],"outputs":[{"uid":"1","id":"out0","clazz":"Flow","text":"","__gohashid":2086}],"loc":"56 31","__gohashid":2054},{"returnType":"CODE20180313181603246","returnTypeName":"Void","inputs":[{"uid":"1","id":"CODE20180321143909643","text":"Flow","clazz":"Flow","__gohashid":2393},{"uid":"2","id":"CODE20180312190822272","text":"대상아이디","clazz":"String","value":"sphere","__gohashid":2405},{"uid":"3","id":"CODE20180312190822272","text":"종료위치","clazz":"String","value":"20 20 0","__gohashid":2415},{"uid":"4","id":"CODE20180312190815795","text":"이동시간","clazz":"Float","value":"1","__gohashid":2426},{"uid":"5","id":"CODE20180312190822272","text":"크기","clazz":"String","value":"20 20 20","__gohashid":2437},{"uid":"6","id":"CODE20180312190822272","text":"회전","clazz":"String","value":"0 0 0","__gohashid":2448},{"uid":"7","id":"CODE20180312190815795","text":"투명도","clazz":"Float","value":"1","__gohashid":2459},{"uid":"8","id":"CODE20180312190822272","text":"색상","clazz":"String","value":"#c9baf7","__gohashid":2470}],"outputs":[{"uid":"9","id":"CODE20180321143909643","text":"Flow","clazz":"Flow","__gohashid":2479}],"id":"NODE20181025192849308","text":"변형","kind":"function","key":2,"loc":"517.0000000000001 64.00285930649818","__gohashid":2364},{"returnType":"CODE20180313181603246","returnTypeName":"Void","inputs":[{"uid":"1","id":"CODE20180321143909643","text":"Flow","clazz":"Flow","__gohashid":2779},{"uid":"2","id":"CODE20180312190822272","text":"내용","clazz":"String","value":"ㅁㅁㅁㅁ","__gohashid":2791}],"outputs":[{"uid":"3","id":"CODE20180321143909643","text":"Flow","clazz":"Flow","__gohashid":2799}],"id":"NODE20181128171524002","text":"경고창","kind":"dialog","key":3,"loc":"153.86429709533354 115.3167217666959","__gohashid":2700}],"linkDataArray":[{"clazz":"Flow","fromNodeKey":1,"fromPinUid":"1","toNodeKey":3,"toPinUid":"1","__gohashid":2803},{"clazz":"Flow","__gohashid":3962,"fromNodeKey":3,"toNodeKey":2,"fromPinUid":"3","toPinUid":"1"}]}},{"id":4,"name":"이벤트 호출시","data":{"linkFromPortIdProperty":"fromPinUid","linkToPortIdProperty":"toPinUid","linkFromKeyProperty":"fromNodeKey","linkToKeyProperty":"toNodeKey","nodeCategoryProperty":"kind","linkCategoryProperty":"clazz","nodeKeyProperty":"key","nodeDataArray":[{"key":1,"id":"CODE20180317171800741","kind":"event","text":"이벤트 호출시","inputs":[{"uid":"1","id":"out0","clazz":"String","text":"호출될 이벤트명"}],"outputs":[{"uid":"1","id":"out0","clazz":"Flow","text":""}],"loc":"0 0"}],"linkDataArray":[]}}]}', '""""', '""');


            var COMP20181203134235438_cp = {
                    schema : {
                    },
                    onInit : function() {

                        this.el.addEventListener("click", function(e){
                            console.log("sphere 클릭!!!");
                        });

                    },
                    onStart : function() {

                    },
                    onMouseDown : function() {
                        console.log("여기들어왔다.");
                        //alert("ㅁㅁㅁㅁ");
                        new Promise(function (resolve, reject) {
                            this.startCoroutine(
                                function* () {
                                    var sumTime = 0.0;

                                    var startPosition = this.el.getAttribute("position");

                                    var directionVector = new THREE.Vector3(0, 0, 0);

                                    directionVector.copy(startPosition);

                                    var endPosition = "20 20 0";

                                    if(endPosition == null || endPosition == undefined || endPosition == ""){
                                        endPosition = directionVector;
                                    }

                                    var startScale = this.el.getAttribute("scale");

                                    var scaleVector = new THREE.Vector3(0, 0, 0);

                                    scaleVector.copy(startScale);

                                    var endScale = "20 20 20";

                                    if(endScale == null || endScale == undefined || endScale == ""){
                                        endScale = scaleVector;
                                    }

                                    var startRotation = this.el.getAttribute("rotation");

                                    var rotationVector = new THREE.Vector3(0, 0, 0);

                                    rotationVector.copy(startRotation);

                                    var endRotation = "0 0 0";

                                    console.log("****************endRotation ");
                                    console.log(endRotation);

                                    if(endRotation == null || endRotation == undefined || endRotation == ""){
                                        endRotation = rotationVector;
                                    }

                                    var startColor = "#ffffff";

                                    var endColor = "#c9baf7";

                                    var startAlpha = 1;

                                    var endAlpha = 1;

                                    if(this.el.hasAttribute("material")){
                                        startColor = this.el.getAttribute("material").color;
                                        startAlpha = this.el.getAttribute("material").opacity;
                                        if(endAlpha == null || endAlpha == undefined || endAlpha == ""){
                                            endAlpha = startAlpha;
                                        }
                                        if(endColor == null || endColor == undefined || endColor == ""){
                                            endColor = startColor;
                                        }
                                    }else if(this.el.hasAttribute("light")){
                                        startColor = this.el.getAttribute("light").color;
                                        if(endColor == null || endColor == undefined || endColor == ""){
                                            endColor = startColor;
                                        }
                                    }

                                    do {
                                        sumTime += Time.deltaTime;

                                        if (1 == 0) {
                                            this.el.setAttribute("position", endPosition);
                                            this.el.setAttribute("scale", endScale);
                                            this.el.setAttribute("rotation", endRotation);
                                            if (this.el.hasAttribute('material')) {
                                                this.el.setAttribute("material", "color", endColor);
                                                this.el.setAttribute("material", "opacity", endAlpha);
                                            } else if (this.el.hasAttribute('light')) {
                                                this.el.setAttribute("light", "color", endColor);
                                            }
                                        } else {
                                            var position = maxUtils.vectorConstant(directionVector, AFRAME.utils.coordinates.parse(endPosition), sumTime, 1);
                                            this.el.setAttribute("position", position);

                                            var scale = maxUtils.vectorConstant(scaleVector, AFRAME.utils.coordinates.parse(endScale), sumTime, 1);
                                            this.el.setAttribute("scale", scale);

                                            var rotation = maxUtils.vectorConstant(rotationVector, AFRAME.utils.coordinates.parse(endRotation), sumTime, 1);
                                            this.el.setAttribute("rotation", rotation);

                                            if (this.el.hasAttribute('material')) {
                                                var color = maxUtils.colorConstant(startColor, endColor, sumTime, 1);
                                                this.el.setAttribute("material", "color", color);
                                                var alpha = maxUtils.constant(startAlpha, endAlpha, sumTime, 1);
                                                this.el.setAttribute("material", "opacity", alpha);
                                            } else if (this.el.hasAttribute('light')) {
                                                var color = maxUtils.colorConstant(startColor, endColor, sumTime, 1);
                                                this.el.setAttribute("light", "color", color);
                                            }
                                        }
                                        yield null;	//1프레임 기다림
                                    } while (sumTime < 1)
                                    this.el.setAttribute("position", endPosition);
                                    this.el.setAttribute("scale", endScale);
                                    this.el.setAttribute("rotation", endRotation);

                                    if (this.el.hasAttribute('material')) {
                                        this.el.setAttribute("material", "color", endColor);
                                        this.el.setAttribute("material", "opacity", endAlpha);
                                    } else if (this.el.hasAttribute('light')) {
                                        this.el.setAttribute("light", "color", endColor);
                                    }

                                    console.log("rotation : ");
                                    console.log(this.el.getAttribute("rotation"));
                                    resolve();
                                }.bind(this)()
                            );
                        }.bind(this)).then(function() {

                        }.bind(this));
                    }
                }
            ;
            __component.dataJs = COMP20181203134235438_cp;

            CustomComponentList.push(__component);
            KFRAME.registerComponent(__component.componentName, __component.dataJs);
        } catch(e) {
        }

    </script>

</head>
<body id="__a-scene-data__">


    <a-scene id="장면" state="" fog="type:exponential;color:#fff;density:0" shadow="type: pcf" broadcast="" class="fullscreen" inspector="" keyboard-shortcuts="" screenshot="" vr-mode-ui="">

        <a-entity id="배경조명" light="type:ambient;color:#BBB"></a-entity>
        <a-entity id="방향조명(직사광선)" position="7.076 3.486 5.665" light="castShadow:true"></a-entity>
        <a-entity id="주카메라" position="-95.313 99.445 152.284">
            <a-entity id="camera" camera="far:100000" look-controls="" wasd-controls="" data-aframe-inspector-original-camera="">
                <a-entity id="rayCursor" cursor="rayOrigin:mouse;" geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.016" material="color:#EEE" position="0 0 -1" raycaster=""></a-entity>
            </a-entity>
        </a-entity>        
        <a-entity id="sphere" geometry="primitive:sphere" position="0 20 0" scale="20 20 20" material="color:#c9baf7" shadow="" clicktest=""></a-entity></a-scene>

</body>
</html>